<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>주식회사 터보테크놀로지</title>
    <link rel="stylesheet" href="/css/reset.css" />
    <link rel="stylesheet" href="/css/common.css" />
    <script type="text/javascript" src="/js/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/js/slick.css" />
    <link rel="stylesheet" type="text/css" href="/js/slick-theme.css" />
    <script type="text/javascript" src="/js/slick.min.js"></script>
    <script type="text/javascript" src="/js/video.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $(".section-productList-wrap").slick({
                slidesToShow: 3,
                slidesToScroll: 1,
                infinite: false,
                variableWidth: true,
            });
        });
    </script>
</head>
<body style="display:none;" id="bodyContent">
<div class="container">
    <header>
        <div class="header-main-container br">
            <div class="header-main-wrap bor">
                <a href="/">
                    <img
                            src="/images/logo/TT_logo.png"
                            alt="logo"
                            class="header-main-logo by"
                    />
                </a>

                <ul class="header-main-menu by">
                    <li><a href="/html/company/company.html">회사소개</a></li>
                    <li><a href="/html/coretech/coretech.html">핵심기술</a></li>
                    <li><a href="/html/product/product.html">제품소개</a></li>
                    <li>
                        <a href="/html/energysave/energysave.html"
                        >에너지 절감 주요 적용 사업</a
                        >
                    </li>
                    <li>
                        <a href="/contact">Contact</a>
                    </li>
                    <li>
                        <a href="/membership/DealerAgent">멤버쉽서비스</a>
                    </li>
                </ul>

                <div class="header-main-login by" id="authLink">
                    <div id="loginLinkContainer">
                        <a href="/user/login">LOGIN</a>
                    </div>
                    <p>|</p>
                    <div class="header-main-lang">
                        <p>KR</p>
                        <img src="/images/icon/arrow_under.png" alt="language" width="8px" height="6px" />
                    </div>
                </div>
                <div class="mobile-header-menu">
                    <span class="mobile-header-menu-bar mobile-header-menu-bar--top"></span>
                    <span class="mobile-header-menu-bar mobile-header-menu-bar--mid"></span>
                    <span class="mobile-header-menu-bar mobile-header-menu-bar--bot"></span>
                </div>
            </div>
        </div>

        <div class="header-sub-container br">
            <div class="header-sub-wrap bor">
                <ul class="header-sub-menu by">
                    <li><a href="/membership/DealerAgent">딜러/에이전트 서비스 비디오</a></li>
                    <li><a href="/membership/Video">고객서비스비디오</a></li>
                    <li><a href="/membership/Gallery">갤러리</a></li>
                    <li><a href="/membership/Media">미디어</a></li>
                    <li><a href="/membership/Newsletter">뉴스레터</a></li>
                    <li id="adminTab" style="display: none;">
                        <a href="/membership/Admin">유저 관리</a>
                    </li>
                </ul>
            </div>
        </div>
    </header>

    <section style="background-color: white; z-index: -1">
        <div class="section-basic-container br">
            <div class="section-basic-wrap bor">
                <p class="query_title">관리자 페이지</p>

                <div class="query_container">
                    <div class="query_header">
                        <div class="query_header_left">
                            <p th:text="'총 ' + ${totalUsers} + '건'"></p>
                        </div>
                        <div class="query_header_right">
                            <div class="query_dropdown">
                                <button class="query_dropbtn">전체</button>
                                <div class="query_dropdown-content">
                                    <a href="#" data-category="all">전체</a>
                                    <a href="#" data-category="username">아이디</a>
                                    <a href="#" data-category="role">권한</a>
                                </div>
                            </div>
                            <input type="text" class="query_search_input" placeholder="입력해 주세요." />
                            <button class="query_searchbtn">검색</button>
                        </div>
                    </div>
                    <div class="query_content">
                        <table>
                            <thead>
                            <tr>
                                <th>No</th>
                                <th>유저명</th>
                                <th>권한</th>
                                <th>수정</th>
                            </tr>
                            </thead>
                            <tbody id="userTable">


                            </tbody>
                        </table>
                    </div>

                    <div style="text-align: center">
                        <button class="query_more_btn" id="load">유저 더보기</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="">
        <div class="footer-container br">
            <div class="footer-wrap br">
                <div class="footer-up">
              <span class="footer-info">
                <p style="color: white">개인정보처리방침</p>
                <p>|</p>
                <p>이용약관</p>
              </span>
                    <span><p class="footer">Copyright © 2023 Turbo Technology Co., LTD. All Rights Reserved.</p></span>
                </div>
                <div class="footer-down">
                    <p class="footer">Address - 경기 화성시 동탄대로21길 10, 더퍼스트타워1차 501호</p>
                    <p>Tel - 031-374-0804</p>
                    <p>Fax - 031-374-0803</p>
                </div>
            </div>
        </div>
    </footer>
</div>
<nav class="side-bar off">
    <div class="side-bar-login-section">
        <a href="">Login</a>
    </div>
    <div class="side-bar-lang-section">
        <span>KOR</span>
        <span>ENG</span>
        <span>CHN</span>
    </div>
    <div class="side-bar-sub-section">
        <div>
            <p><a href="/html/company/company.html">회사소개</a></p>
            <ul>
                <li>
                    <a href="/html/company/ceo.html">CEO 인사말</a>
                </li>
                <li>
                    <a href="/html/company/companyinfo.html">회사소개</a>
                </li>
                <li>
                    <a href="/html/company/people.html">조직도</a>
                </li>
            </ul>
        </div>
        <div>
            <p><a href="/html/coretech/coretech.html">핵심기술</a></p>
            <ul>
                <li>
                    <a href="/html/coretech/uhepmmotor.html">UHEPM Motor</a>
                </li>
                <li>
                    <a href="/html/coretech/nbwairfoilbearing.html">NBW Air Foil Bearing</a>
                </li>
                <li>
                    <a href="/html/coretech/supersonicimpeller.html">Supersonic Impeller</a>
                </li>
                <li>
                    <a href="/html/coretech/dualaircoolingsystem.html">Dual Air Cooling System</a>
                </li>
                <li>
                    <a href="/html/coretech/autosurgeprotectionsystem.html">Auto Surge Protection System</a>
                </li>
                <li>
                    <a href="/html/coretech/internalcoolingairsystem.html">Internal Cooling Air System</a>
                </li>
                <li>
                    <a href="/html/coretech/anti-explosiveturbomotor.html">Anti-Explosive Turbo Motor</a>
                </li>
                <li>
                    <a href="/html/coretech/ambientlighting.html">Ambient Lighting</a>
                </li>
                <li>
                    <a href="/html/coretech/smarthmi.html">SMART HMI</a>
                </li>
            </ul>
        </div>
        <div>
            <p><a href="/html/product/product.html">제품소개</a></p>
            <ul>
                <li>
                    <a href="/html/product/WH-SERIES.html">WH Series 터보 컴프레서</a>
                </li>
                <li>
                    <a href="/html/product/WL-SERIES.html">WL Series 터보 블로워</a>
                </li>
            </ul>
        </div>
        <div>
            <p><a href="/html/energysave/energysave.html"> 에너지 절감 주요 적용 사업</a></p>
            <ul>
                <li>
                    <a href="/html/energysave/2차전지.html">2차전지</a>
                </li>
                <li>
                    <a href="/html/energysave/바이오케미컬.html">바이오케미컬</a>
                </li>
                <li>
                    <a href="/html/energysave/반도체디스플레이.html">반도체디스플레이</a>
                </li>
                <li>
                    <a href="/html/energysave/석유화학.html">석유화학</a>
                </li>
                <li>
                    <a href="/html/energysave/식음료.html">식음료</a>
                </li>
                <li>
                    <a href="/html/energysave/양조발효.html">양조발효</a>
                </li>
                <li>
                    <a href="/html/energysave/수처리환경.html">수처리/환경</a>
                </li>
                <li>
                    <a href="/html/energysave/발전.html">발전</a>
                </li>
                <li>
                    <a href="/html/energysave/금속제강제련.html">금속/제강/제련</a>
                </li>
                <li>
                    <a href="/html/energysave/조선선박.html">조선선박</a>
                </li>
                <li>
                    <a href="/html/energysave/광업.html">광업</a>
                </li>
                <li>
                    <a href="/html/energysave/시멘트분말분체.html">시멘트/분말/분체업</a>
                </li>
            </ul>
        </div>
        <div>
            <p><a href="/contact">Contact</a></p>
            <ul>
                <li>
                    <a href="/contact">견적문의</a>
                </li>
                <li>
                    <a href="/html/contact/query_normal.html">일반문의</a>
                </li>
                <li>
                    <a href="/html/contact/location.html">위치</a>
                </li>
            </ul>
        </div>
        <div>
            <p><a href="/membership/DealerAgent">멤버쉽서비스</a></p>
            <ul>
                <li>
                    <a href="/membership/DealerAgent">딜러/에이전트 서비스 비디오</a>
                </li>
                <li>
                    <a href="/membership/Video">고객서비스비디오</a>
                </li>
                <li>
                    <a href="/membership/Gallery">갤러리</a>
                </li>
                <li>
                    <a href="/membership/Media">미디어</a>
                </li>
                <li>
                    <a href="/membership/Newsletter">뉴스레터</a>
                </li>
                <li id="adminSideTab" style="display: none;">
                    <a href="/membership/Admin">유저 관리</a>
                </li>
            </ul>
        </div>
    </div>
</nav>
</div>
</body>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var userRole = localStorage.getItem('role');
        if (userRole !== 'ADMIN') {
            alert("관리자 계정으로 로그인 해주세요.");
            window.location.href = '/';
        } else {
            document.getElementById('bodyContent').style.display = 'block';
        }
    });
</script>
<script type="text/javascript">
    $(document).ready(function () {
        $(".mobile-header-menu").click(function () {
            if ($(this).hasClass("on")) {
                $(this).removeClass("on");
                $(".mobile-header-menu-bar--mid").show(300);
                $(".mobile-header-menu-bar--top").removeClass("on");
                $(".mobile-header-menu-bar--bot").removeClass("on");
                $("body").removeClass("off");
                $(".side-bar").addClass("off");
            } else {
                $(this).addClass("on");
                $(".mobile-header-menu-bar--mid").hide(300);
                $(".mobile-header-menu-bar--top").addClass("on");
                $(".mobile-header-menu-bar--bot").addClass("on");

                $("body").addClass("off");
                $(".side-bar").removeClass("off");
            }
        });
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var userRole = localStorage.getItem('role');
        if (userRole === 'ADMIN') {
            document.getElementById('adminTab').style.display = 'list-item';
            document.getElementById('adminSideTab').style.display = 'list-item';
        }
    });
</script>

<script type="text/javascript">
    $(document).ready(function () {
        var currentPage = 0; // 현재 페이지 번호
        var size = 5; // 한 페이지에 표시할 유저 수
        var isLastPage = false; // 마지막 페이지여?
        var selectedCategory = 'all';

        // 카테고리
        $(".query_dropdown-content a").click(function(e) {
            e.preventDefault();
            var selectedCategory = $(this).data("category");
            $(".query_dropbtn").text($(this).text());
            // 카테고리 변경 시 초기화
            loadUsers(selectedCategory, '', 0);
        });

        // 검색 버튼 클릭 이벤트
        $(".query_searchbtn").click(function() {
            var searchKeyword = $(".query_search_input").val();
            // 새 검색어로 검색
            if (selectedCategory === 'role') {
                searchKeyword = convertRoleToQuery(searchKeyword);
            }
            loadUsers(selectedCategory, searchKeyword, 0);
        });

        // 더 보기 버튼 클릭 이벤트
        $("#load").click(function(e) {
            e.preventDefault();
            if (!isLastPage) {
                // 다음 페이지 가져오기
                loadUsers('all', $(".query_search_input").val(), currentPage + 1);
            }
        });

        // 첫번째 페이지 데이터 출력
        loadUsers('all', '', currentPage);

        function translateRole(role) {
            switch(role) {
                case 'GENERAL':
                    return '일반';
                case 'RETAIL':
                    return '대리점';
                case 'ADMIN':
                    return '관리자';
                case 'USER':
                    return '유저';
                default:
                    return '알 수 없음';
            }
        }

        function convertRoleToQuery(keyword) {
            const roleMap = {
                '일반': 'GENERAL',
                '대리점': 'RETAIL',
                '관리자': 'ADMIN',
                '유저': 'USER'
            };

            // 사용자 입력에 해당하는 RoleType 반환, 일치하는 것이 없으면 입력값 그대로 반환
            return roleMap[keyword] || keyword;
        }
        function loadUsers(category, keyword, page) {
            if (page === 0) {
                // 새로운 카테고리 검색 시 테이블 0으로 비우고 깔끔하게.
                $("#userTable").empty();
            }

            $.ajax({
                url: '/membership/Admin/search',
                type: 'GET',
                data: {
                    category: category,
                    keyword: keyword,
                    page: page,
                    size: size
                },
                dataType: 'json',
                success: function(response) {
                    var $userTable = $("#userTable");
                    var startIndex = page * size;

                    // 게시물 내용 추가하기
                    $.each(response.content, function(i, user) {
                        var userNumber = startIndex + i + 1; // 1부터 시작
                        var userRole = translateRole(user.role);
                        var row = '<tr>' +
                            '<td>' + userNumber + '</td>' +
                            '<td>' + user.username + '</td>' +
                            '<td>' + userRole + '</td>' +
                            '<td><a class="btn btn-warning" href="/admin/usermanage/' + user.id + '">수정하기</a></td>' +
                            '</tr>';
                        $userTable.append(row);
                    });

                    // 마지막 페이지 여부 업데이트
                    isLastPage = response.last;
                    // "더 보기" 버튼 숨기기/보이기
                    if (isLastPage) {
                        $('#load').hide();
                    } else {
                        $('#load').show();
                    }

                    // 현재 페이지 업데이트
                    if (response.content.length > 0) {
                        currentPage = page;
                    }

                    // 총 개수 업데이트
                    $(".query_header_left p").text("총 " + response.totalUsers + "건");
                },
                error: function(xhr, status, error) {
                    alert("에러: " + error);
                }
            });
        }
    });
</script>
<!--<script>
    $(function() {
        // 검색 조건, 현재 페이지 번호 선언
        var selectedCategory = 'all';
        var searchKeyword = '';
        var currentPage = 0;

        // 카테고리 설정
        $(".query_dropdown-content a").click(function(e) {
            e.preventDefault();
            selectedCategory = $(this).data("category");
            $(".query_dropbtn").first().text($(this).text());
        });

        // 검색 버튼 클릭 이벤트
        $(".query_searchbtn").click(function() {
            searchKeyword = $(".query_search_input").val(); // 검색어 값
            currentPage = 0; // 첫페이지부터 받기
            searchPosts(); // 게시글 출력 함수
        });

        // 더 보기 버튼
        $("#load").click(function(e) {
            e.preventDefault();
            currentPage++; // 페이지번호 증가
            searchPosts(); // 게시글 출력 함수
        });
        function searchPosts() {
            $.ajax({
                url: '/membership/Admin/search',
                type: 'GET',
                data: {
                    category: selectedCategory,
                    keyword: searchKeyword,
                    page: currentPage,
                    size: 5
                },
                dataType: 'json',
                success: function(response) {
                    var $userTable = $("#userTable");
                    var totalUsers = response.totalUsers;
                    var size = 5;
                    var startIndex = (currentPage === 0) ? totalUsers : totalUsers - (currentPage * size);
                    /*if (currentPage === 0) {    // 페이지부터 우선적으로 비워줘야 값이 제대로 나옴.
                        $("table tbody").empty();
                    }*/
                    $userTable.empty()
                    // 게시물 내용 받아오기
                    if (response.content.length > 0) {
                        $.each(response.content, function(i, user) {
                            var userNumber = startIndex - i;
                            var row = '<tr>' +
                                '<td>' + userNumber + '</td>' +
                                // '<td>' + user.id + '</td>' +
                                '<td>' + user.username + '</td>' +
                                '<td>' + user.role + '</td>' +
                                '<td><a class="btn btn-warning" href="/admin/usermanage/' + user.id + '">수정하기</a></td>' +
                                '</tr>';
                            $userTable.append(row);
                        });
                    } else if (currentPage === 0) {
                        // 게시물이 아예 없으면
                        var row = '<tr><td colspan="4">검색 결과가 없습니다.</td></tr>';
                        $userTable.append(row);
                    }

                    // 검색결과가 다 출력되면 더보기 버튼 숨기기
                    if (response.last) {
                        $('#load').hide();
                    } else {
                        $('#load').show();
                    }

                    // 총 개수 업데이트
                    $(".query_header_left p").text("총 " + response.totalUsers + "건");
                },
                error: function(xhr, status, error) {
                    alert("에러에러에러에러: " + error);
                }
            });
        }
    });
</script>-->
<script src="/js/require/user.js"></script>
</body>
</html>
